<?xml version="1.0" encoding="UTF-8"?><record_update sys_domain="global" table="sysevent_script_action">
    <sysevent_script_action action="INSERT_OR_UPDATE">
        <active>true</active>
        <condition_script/>
        <description/>
        <event_name>idea.score.changed</event_name>
        <name>Update Idea Scores</name>
        <order>100</order>
        <script><![CDATA[/*
 Fired when a user's score is modified to sequentially update all of that
 user's ideas to reflect the new weighting factor.
*/
var c = new IdeaScoreCalculator();

// First look up the submitter's score.
var userScores = new GlideRecord('u_idea_user_score');
userScores.query('u_user',current.u_submitter);
var userScore = 0;
if (userScores.next()) {
	userScore = userScores.u_score;
}
// Then update the user's score with this updated idea.
var gr = new GlideRecord('u_idea');
gr.addQuery('u_submitter',current.u_submitter);
gr.query();
gr.setWorkflow(false);
	
while(gr.next()) {
	var ideaScore = c.calculateIdeaScore(gr,userScore);
	gr.u_score = ideaScore;
	gs.log("$$$ Event processed: updated score for " + gr.short_description + " to " + ideaScore);
	gr.update();	
}
]]></script>
        <synchronous>false</synchronous>
        <sys_class_name>sysevent_script_action</sys_class_name>
        <sys_created_by>admin</sys_created_by>
        <sys_created_on>2014-03-26 21:02:11</sys_created_on>
        <sys_customer_update>true</sys_customer_update>
        <sys_domain>global</sys_domain>
        <sys_domain_path>/</sys_domain_path>
        <sys_id>3b941d4c6ff71100bd5f9122be3ee40e</sys_id>
        <sys_mod_count>0</sys_mod_count>
        <sys_name>Update Idea Scores</sys_name>
        <sys_overrides/>
        <sys_package display_value="Ideaville" source="6a3741c86ff71100bd5f9122be3ee416">6a3741c86ff71100bd5f9122be3ee416</sys_package>
        <sys_policy/>
        <sys_replace_on_upgrade>false</sys_replace_on_upgrade>
        <sys_scope display_value="Ideaville">6a3741c86ff71100bd5f9122be3ee416</sys_scope>
        <sys_update_name>sysevent_script_action_3b941d4c6ff71100bd5f9122be3ee40e</sys_update_name>
        <sys_updated_by>admin</sys_updated_by>
        <sys_updated_on>2014-03-26 21:02:11</sys_updated_on>
    </sysevent_script_action>
</record_update>
